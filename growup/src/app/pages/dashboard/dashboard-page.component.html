<mat-drawer-container class="app-shell">
  <mat-drawer
    *ngIf="settingsOpen()"
    class="settings-drawer"
    position="end"
    mode="over"
    [opened]="settingsOpen()"
    (closedStart)="closeSettings()"
  >
    <app-settings-dialog
      [accountSettings]="accountSettings()"
      [profileSettings]="settings()"
      [profiles]="profiles()"
      [activeProfileId]="activeProfileId()"
      (closeSettings)="closeSettings()"
      (saveSettings)="saveSettings($event)"
      (selectProfile)="selectProfile($event)"
      (deleteProfile)="deleteProfile($event)"
    />
  </mat-drawer>
  <mat-drawer
    *ngIf="profileOpen()"
    class="profile-drawer"
    position="end"
    mode="over"
    [opened]="profileOpen()"
    (closedStart)="closeProfile()"
  >
    <app-profile-dialog
      [settings]="settings()"
      [profiles]="profiles()"
      [activeProfileId]="activeProfileId()"
      [mode]="profileMode()"
      (closeProfile)="closeProfile()"
      (saveProfile)="saveProfile($event)"
      (selectProfile)="selectProfile($event)"
      (deleteProfile)="deleteProfile($event)"
    />
  </mat-drawer>
  <mat-drawer-content class="app-content">
    <app-topbar
      [balance]="balance()"
      [isOnline]="isOnline()"
      [isSyncing]="appStatus.isSyncing()"
      [lastSyncAt]="appStatus.lastSyncAt()"
      [syncError]="appStatus.syncError()"
      [avatarSrc]="avatarSrc()"
      [profiles]="profiles()"
      [activeProfileId]="activeProfileId()"
      [maxProfiles]="maxProfiles()"
      [showLanguageSelect]="false"
      (settingsClick)="openSettings()"
      (profileCreate)="openCreateProfile()"
      (profileEdit)="openSettings()"
      (profileSelect)="selectProfile($event)"
      (openAuthDialog)="openAuthDialog()"
    />

    <main class="page ds-scope">
      <app-dashboard-hero-section
        [showDashboard]="showDashboard()"
        [loading]="appStatus.isSyncing()"
        [avatarSrc]="avatarSrc()"
        [level]="level()"
        [xpToNext]="xpToNext()"
        [progressPercent]="progressPercent()"
        [earned]="earned()"
        [spent]="spent()"
        [available]="balance()"
        [cycleLabel]="cycleLabel()"
        [cycleEarned]="cycleEarned()"
        [cycleRangeLabel]="cycleRangeLabel()"
        [previousCycleEarned]="previousCycleEarned()"
        [previousCycleLabel]="previousCycleLabel()"
      />

      <app-onboarding-card
        *ngIf="showOnboarding() || showProfileOnboarding()"
        (createProfile)="openCreateProfile()"
      />

      <app-dashboard-panels-section
        [showDashboard]="showDashboard()"
        [showRewardsPanel]="showRewardsPanel()"
        [tasks]="tasks()"
        [todayDoneIds]="todayDoneIds()"
        [selectedDate]="selectedDate()"
        [todayKey]="todayKey()"
        [loading]="appStatus.isSyncing()"
        [rewards]="rewards()"
        [balance]="balance()"
        [redemptions]="redemptions()"
        [rewardUses]="rewardUses()"
        [cycleStart]="currentCycleRange().start"
        [cycleEnd]="currentCycleRange().end"
        [rewardsAdvancedEnabled]="rewardsAdvancedEnabled()"
        (selectedDateChange)="setSelectedDate($event)"
        (addTask)="openTaskDialog()"
        (toggleTask)="toggleTask($event)"
        (removeTask)="removeTask($event)"
        (addReward)="openRewardDialog()"
        (redeemReward)="redeemReward($event)"
        (consumeReward)="consumeReward($event)"
        (returnRedemption)="returnRedemption($event)"
        (removeReward)="removeReward($event)"
      />

      <app-footer [currentYear]="currentYear" [buildTime]="buildTime" [showBuildTime]="true" />
    </main>
  </mat-drawer-content>
</mat-drawer-container>
